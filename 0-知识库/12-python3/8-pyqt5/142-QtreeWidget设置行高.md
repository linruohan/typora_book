#  QtreeWidget
qt官网有帮助文档,可以借助翻译软件或者插件查看，我最喜欢的方法是先用__dir__方法把类的方法列表打印出来，如下图是QTreeWidget的小部分方法截图。
![img](D:\Typora_pic\614a2a34349b033b048ffb3d1bce36d3d439bdb6.jpg)

QTreeWidget的父类如图：
![img](D:\Typora_pic\1db3ff1f4134970a8fcc17c89bcad1c8a6865d7e.jpg)

注：来自于qt官方网站帮助文档
QTreeWidget的父类是QTreeView，往上还有，从官方网站只能得到在QTreeWidget中定义或者重新定义的方法，而看不到其父类的方法，所以通过__dir__方法可以获取所有父类的方法。
然后用idle可以查看方法参数，返回类型，如下图
![img](D:\Typora_pic\356a1bd8bc3eb135848cb15ca81ea8d3fc1f446a.jpg)
![img](D:\Typora_pic\3261a38b87d6277fbed835df26381f30eb24fceb.jpg)

如果这里还找不到你想要的，可以去官网试试看，如下图（currentItem方法）：
![img](D:\Typora_pic\f7c7db33c895d14359cbe2c47df082025baf077c.jpg)

注：这是用翻译插件翻译的
当然也可以直接把方法名翻译一下有意想不到的效果
![img](D:\Typora_pic\e46fdbf9d72a60597cffe7fd2634349b013bbace.jpg)

pyqt的方法名一般是首单词全小写，第二个单词开始每个的首字母大写。类名一般都是Q开头，后面所有单词首字母大写。所以翻译的时候很容易分词
后面楼层主要说一下在使用过程中遇到的一些问题和解决的方法，基本用法就不多说了，看书自己研究。

##  本贴主要说的是QTreeWidget控件（以下简称Tree）。
1. Tree提供了文本换行，居然没有提供行高调整，不能设置行高，不能自适应行高，这点真的是要吐槽
2. Tree的单元格可以编辑，居然只显示一行，我这多行数据
3. Tree提供了columnResized方法（继承自父类QTreeView），官网解释是（机器翻译）：无论何时column标题中更改大小，都会调用此函数。oldSize并newSize给出以前的大小和新的大小（以像素为单位），然鹅，我调整列宽并不会触发该函数，那么我列宽改变了之后又该怎么调整以适应单元格内容显示呢？
   ![img](D:\Typora_pic\f7c7db33c895d1435c1de7c47df082025baf074a.jpg)
   ![img](D:\Typora_pic\039d5066d01609244f43a1fcda0735fae7cd3457.jpg)

1.QTreeWidget提供了文本换行，居然没有提供==行高调整，不能设置行高，不能自适应行高==，这点真的是要吐槽
既然不能设置行高，我们可以变相来处理，百度也有一些其他的方案，最后感觉不好用。后来我发现QTreeWidget可以根据字体调整高度显示，这就找到了突破点。具体做法是：
==①.把第一列留空==
==②.计算文本长度==，因为考虑到中文和英文字符宽度不同，我初始的时候将中文设定为2个字符，英文占1个字符，最后发现大约32个汉字的宽度与60个英文字母宽度差不多，所以最后我将英文按32/30个字符考虑的。把这个函数明明为lenb
![img](D:\Typora_pic\0fc1cf11728b4710b30f312bcdcec3fdfd032391.jpg)
![img](D:\Typora_pic\ff8d2c738bd4b31cd1f4595c89d6277f9c2ff8ea.jpg)

get_width来自于一个第三方模块——urwid，我只要这一段代码，所以就没有加载该模块，只把代码拿来用了。
③.根据文本长度和列宽计算文本行数
<img src="D:\Typora_pic\945fba0e7bec54e7f56cd6f9b7389b504ec26a32.jpg" alt="img" style="zoom:150%;" />

这里可能就比较麻烦，因为每个字号的文字宽度不同，间距不同，所以可能需要测试比较多的数据才能计算出每种字号情况下任意列宽一行最多字符长度，目前我将字号定为11号字，只测试了该种情况下的对应关系。
floor函数为向下取整，来自math模块。（才想起来int函数好像也可以![img](D:\Typora_pic\i_f04.png)）
ceil也来自math模块，为向上取整。
也就是，一行所能容下的字符数尽量少算，所以用floor，文本所占行数尽量多算，用ceil。
④.下面就是计算首列的字号应该设置为多少，才能使得其他列能显示全部的文本了。
行高涉及到文本行数，字号，行间距，因为我这行间距和字号都是固定的，所以可以暂不考虑，只需考虑行数对其影响，为此定义一个方法updateheight用来更新高度（首列字号），实际就是建立字号（首列）—文本行数对应关系，这都需要自己测试才能出来结果。
按显示文本为11号字，行数记为n的话，那么首列字号需设置为：(17*n+5)/2+n*3
![img](D:\Typora_pic\ba4440a7d933c895fdfd579cdf1373f083020032.jpg)

这里的fontsize就是其他列的文字大小，我这计算公式是按11计算的，这里预留后期需要扩展到其他字号，暂时用不到该参数。
下面QTreeWidgetItem类下需要增加的函数
<img src="D:\Typora_pic\1c8c8813632762d09a276a58aeec08fa503dc699.jpg" alt="img" style="zoom:150%;" />

setLineCountWithWidth函数（意思是根据列宽设置行数）是用来在打开文件、调整列宽等操作后（因为没有添加编辑框，所以不能直接从编辑框读取行数）计算行数用的。
而当打开文件后编辑时由于编辑框的存在，每次完成文本编辑后均可以根据文本高度计算出行数，这个就比较准确，此时直接用setlinecount来设置行数。
注：我的列表中只有名称列需要换行，其他列的文本就比较少，所以就不考虑换行了