# 基础语法

[toc]



## 变量作用域

### 形参、局部变量

![image-20230702081944918](imgs/image-20230702081944918.png)

值传递和引用传递
```go
//值传递和引用传递
func ReferenceCase(a int ,b *int){
    a+=1
    *b+=1
}
// ======================
a:=10
b:=20
_case.ReferenceCasse(a,&b)
```
![image-20230702081905143](imgs/image-20230702081905143.png)![image-20230702081916350](imgs/image-20230702081916350.png)

### 全局变量(当前包的全局变量)

![image-20230702082408262](imgs/image-20230702082408262.png)

![image-20230702082542770](imgs/image-20230702082542770.png)

![image-20230702082629601](imgs/image-20230702082629601.png)

## 泛型 generic  T

![image-20230702082826472](imgs/image-20230702082826472.png)

~ 衍生类型

### 泛型使用 [T interface{int|float64}]

![image-20230702083825419](imgs/image-20230702083825419.png)

![image-20230702083751853](imgs/image-20230702083751853.png)

![image-20230702083904857](imgs/image-20230702083904857.png)

#### 别名和衍生类型

![image-20230702084427787](imgs/image-20230702084427787.png)

![image-20230702084720450](imgs/image-20230702084720450.png)

#### 内置类型

![image-20230702085100135](imgs/image-20230702085100135.png)

comparable

![image-20230702085048462](imgs/image-20230702085048462.png)

any

![image-20230702085227993](imgs/image-20230702085227993.png)

### 泛型类型

![image-20230702085551966](imgs/image-20230702085551966.png)

![image-20230702085601907](imgs/image-20230702085601907.png)

![image-20230702085623795](imgs/image-20230702085623795.png)

![image-20230702085946804](imgs/image-20230702085946804.png)

> 控制台异常打印,限制

![image-20230702090028348](imgs/image-20230702090028348.png)

![image-20230702090311015](imgs/image-20230702090311015.png)

#### 泛型切片

`type List[T any] []T`

#### 泛型集合

`type MapT[k comparable,v any] map[k]v`

#### 泛型通道

`type Chan[T any] chan T`

![image-20230702091022641](imgs/image-20230702091022641.png)

### 泛型接口

基本接口: 可用于变量的定义
```go
type ToString interface{
    String() string
}
// type s ToString
```

泛型接口

```go
type GetKey[T comparable] interface{
    any
    Get() T
}
// type s GetKey[T] 会报错，不确定的类型
// type s GetKey[comparable] 也会报错，不确定的类型
// type s GetKey[string] 会报错
```

![image-20230702091850796](imgs/image-20230702091850796.png)

列表转集合

![image-20230702092532121](imgs/image-20230702092532121.png)

![image-20230702092600045](imgs/image-20230702092600045.png)

![image-20230702092510905](imgs/image-20230702092510905.png)

### 泛型结构体和receiver

![image-20230702093053244](imgs/image-20230702093053244.png)

![image-20230702093154533](imgs/image-20230702093154533.png)

## 流程控制

![image-20230702093706617](imgs/image-20230702093706617.png)![image-20230702093755296](imgs/image-20230702093755296.png)

死循环：

![image-20230702093836831](imgs/image-20230702093836831.png)

嵌套循环：

![image-20230702093934805](imgs/image-20230702093934805.png)

跳出label

![image-20230702100813108](imgs/image-20230702100813108.png)

### switch

fallthrough 穿透

![image-20230702100951566](imgs/image-20230702100951566.png)

![image-20230702101040303](imgs/image-20230702101040303.png)

### goto语句

![image-20230702101328849](imgs/image-20230702101328849.png)

## golang标准库

![image-20230702101413605](imgs/image-20230702101413605.png)

![image-20230702101516895](imgs/image-20230702101516895.png)

![image-20230702101543699](imgs/image-20230702101543699.png)

常用包

![image-20230702101625630](imgs/image-20230702101625630.png)

![image-20230702101645738](imgs/image-20230702101645738.png)

### encoding

![image-20230702102226061](imgs/image-20230702102226061.png)

#### json

![image-20230702101938868](imgs/image-20230702101938868.png)

#### base64编解码

![image-20230702102042664](imgs/image-20230702102042664.png)

#### 16进制编解码  hex

![image-20230702102130996](imgs/image-20230702102130996.png)

### error

自定义error

![image-20230702102856345](imgs/image-20230702102856345.png)

![image-20230702103037781](imgs/image-20230702103037781.png)

### fmt

#### 输出位置

![image-20230702103539075](imgs/image-20230702103539075.png)

#### 占位符

##### 通用占位符

%% 输出百分号

![image-20230702103804754](imgs/image-20230702103804754.png)![image-20230702103743493](imgs/image-20230702103743493.png)

##### 	整数占位符

![image-20230702104219137](imgs/image-20230702104219137.png)![image-20230702104247995](imgs/image-20230702104247995.png)

##### 宽度占位符

![image-20230702104459799](imgs/image-20230702104459799.png)
![image-20230702104441500](imgs/image-20230702104441500.png)

##### 浮点占位符

![image-20230702104953493](imgs/image-20230702104953493.png)![image-20230702105016064](imgs/image-20230702105016064.png)

##### 字符串占位符

![image-20230702105410963](imgs/image-20230702105410963.png)![image-20230702105420445](imgs/image-20230702105420445.png)

##### 指针占位符

![image-20230702105548283](imgs/image-20230702105548283.png)![image-20230702105556775](imgs/image-20230702105556775.png)

### log

![image-20230702105747905](imgs/image-20230702105747905.png)

![image-20230702105709723](imgs/image-20230702105709723.png)

![image-20230702105806062](imgs/image-20230702105806062.png)

![image-20230702105905398](imgs/image-20230702105905398.png)

![image-20230702105845844](imgs/image-20230702105845844.png)

### math

![image-20230702110030269](imgs/image-20230702110046284.png)![image-20230702110101676](imgs/image-20230702110101676.png)

### reflect

![image-20230702110411581](imgs/image-20230702110411581.png)

![image-20230702112202262](imgs/image-20230702112202262.png)![image-20230702112229305](imgs/image-20230702112229305.png)

slice

![image-20230702113357572](imgs/image-20230702113357572.png)![image-20230702113428497](imgs/image-20230702113428497.png)![image-20230702113442857](imgs/image-20230702113442857.png)

### regexp

![image-20230702113908256](imgs/image-20230702113908256.png)

### sort

#### 根据年龄从小到大

![image-20230702114115582](imgs/image-20230702114115582.png)
![image-20230702114132346](imgs/image-20230702114132346.png)



#### 按照id排序

自定义排序的类型，实现Len、Swap、Less

​	![image-20230702114333405](imgs/image-20230702114333405.png)![image-20230702114418092](imgs/image-20230702114418092.png)

![image-20230702114430495](imgs/image-20230702114430495.png)

## 数据类型和变量

rune是int32别名

![image-20230702114703393](imgs/image-20230702114703393.png)

### 类型定义

值类型默认至为0，引用类型默认值为nil

#### 值类型

![image-20230702115418244](imgs/image-20230702115418244.png)

![image-20230702115436385](imgs/image-20230702115436385.png)

#### 引用类型

![image-20230702115629668](imgs/image-20230702115629668.png)

### 常量定义

![image-20230702120240904](imgs/image-20230702120240904.png)

iota  _跳过_

![image-20230702120439899](imgs/image-20230702120439899.png)

### 结构体类型

![image-20230702151908614](imgs/image-20230702151908614.png)

![image-20230702152108325](imgs/image-20230702152108325.png)

### new和make

new可以用于创建任意类型。并返回指针

![image-20230702152852986](imgs/image-20230702152852986.png)

make 仅仅用于切片、通道、集合的初始化

![image-20230702153440789](imgs/image-20230702153440789.png)

![image-20230702162107840](imgs/image-20230702162107840.png)

![image-20230702162319614](imgs/image-20230702162319614.png)

### 类型转换：

![image-20230702163240364](imgs/image-20230702163240364.png)

#### string与[]byte

![image-20230702172255850](imgs/image-20230702172255850.png)![image-20230702172320558](imgs/image-20230702172320558.png)

#### 字符串与rune转换

type rune int32

![image-20230702172450832](imgs/image-20230702172450832.png)

![image-20230702172607747](imgs/image-20230702172607747.png)

#### 接口类型转具体类型

![image-20230702172619369](imgs/image-20230702172619369.png)

![image-20230702172632357](imgs/image-20230702172632357.png)

#### 时间类型转字符串

![image-20230702172832879](imgs/image-20230702172832879.png)![image-20230702172845476](imgs/image-20230702172845476.png)

#### uintptr 无符号指针类型

![image-20230702173210657](imgs/image-20230702173210657.png)

## 语言结构+语法基础

![image-20230702173243364](imgs/image-20230702173243364.png)![image-20230702173252195](imgs/image-20230702173252195.png)

![image-20230702174600311](imgs/image-20230702174600311.png)

### 预定义标识

![image-20230702174956897](imgs/image-20230702174956897.png)

### 运算符和优先级

#### 算术运算符

![image-20230702175148058](imgs/image-20230702175148058.png)![image-20230702175307217](imgs/image-20230702175307217.png)

#### 关系运算

![image-20230702175228432](imgs/image-20230702175228432.png)![image-20230702175239810](imgs/image-20230702175239810.png)

#### 逻辑运算

![image-20230702175334458](imgs/image-20230702175334458.png)![image-20230702175344898](imgs/image-20230702175344898.png)

#### 位运算

![image-20230702175422905](imgs/image-20230702175422905.png)<img src="imgs/image-20230702175436247.png" alt="image-20230702175436247"  />![image-20230702175705261](imgs/image-20230702175705261.png)![image-20230702175824056](imgs/image-20230702175824056.png)![image-20230702175936552](imgs/image-20230702175936552.png)![image-20230702175953210](imgs/image-20230702175953210.png)

#### 赋值运算

![image-20230702180157726](imgs/image-20230702180157726.png)

![image-20230702180230235](imgs/image-20230702180230235.png)

#### 运算符优先级

![image-20230702180517709](imgs/image-20230702180517709.png)

## 异常捕获处理defer/recover

### 应用场景

#### defer：

```bash
1、资源释放
2、异常捕获和处理
```

![image-20230702181128389](imgs/image-20230702181128389.png)

#### recover

![image-20230702181253772](imgs/image-20230702181253772.png)

#### panic

![image-20230702181306953](imgs/image-20230702181306953.png)

### 实例

#### 一般用法

![image-20230702211939444](imgs/image-20230702211939444.png)![image-20230702211955883](imgs/image-20230702211955883.png)

#### 参数预计算

![image-20230702212249886](imgs/image-20230702212249886.png)![image-20230702212313504](imgs/image-20230702212313504.png)

#### 返回值

![image-20230702212628732](imgs/image-20230702212628732.png)

![image-20230702212636385](imgs/image-20230702212636385.png)![image-20230702212729250](imgs/image-20230702212729250.png)

#### 异常处理

![image-20230702213009675](imgs/image-20230702213009675.png)![image-20230702213020456](imgs/image-20230702213020456.png)

#### 资源释放清理

![image-20230702213125877](imgs/image-20230702213125877.png)

![image-20230702213433781](imgs/image-20230702213433781.png)

## interface隐式实现

1. golang对象实现interface无须任何关键词，只需该对象的方法集中包含接口定义的所有方法且方法签名一致
2. 对象实现接口可以借助struct内嵌的特性，实现接口的默认实现
3. 类型T方法集包含全部receiver T方法；类型*T方法集包含 receiver T + *T方法
4. 类型T实例 value 或 pointer 可以调用全部的方法，编译器会自动转换
5. 类型T实现接口，不管是T还是*T都实现了个该接口
6. 类型*T实现接口，只有T类型的指针实现了个该接口
   

## 函数式编程和闭包

![image-20230708122807019](imgs/image-20230708122807019.png)


```go
//调用函数
sum(1,2)
//函数赋值给变量，再调用
f=sum
f(1,2)
//将函数作为输入输出实现中间件
f2=logmiddleware(sum)
f2(1,2)
// 函数类型的方法
f3=SumFunc(f1) //将f1强制转为SumFunc类型
f3.Accumulation(1,2,3,4)
f2.Accumulation(1,2,3,4)
```

![image-20230708123513650](imgs/image-20230708123513650.png)

![image-20230708123715842](imgs/image-20230708123715842.png)

![image-20230708124106746](imgs/image-20230708124106746.png)

### 斐波那契数列

```go
// x0+x1=x2。。。 求xn的值
func tool() func()int{
    var x0=0
    var x1=1
    var x2=0
    return func()int{
        x2=x0+x1
        x0=x1
        x1=x2
        return x2
    }
}

func Fib(n int)int{
    if (n<=2){
        log.Fatal("n必须大于2")
    }
    t:=tool()
    var res int
    for i:=0;i<n-2;i++{
        res=t()
    }
    return res
}
```

阻塞主协程

![image-20230708125943352](imgs/image-20230708125943352.png)

![image-20230708130130030](imgs/image-20230708130130030.png)

## 通过通信共享内存

![image-20230708130634527](imgs/image-20230708130634527.png)

### 通讯共享内存---协程间通讯

channel： 分类

1. 只读 ch <-chan int
2. 只写 ch chan<- int
3. 读写 ch:=make(chan int,0)



![image-20230708130937415](imgs/image-20230708130937415.png)

![image-20230708131002264](imgs/image-20230708131002264.png)

![image-20230708131056480](imgs/image-20230708131056480.png)

channel阻塞主进程和子协程，需要手动退出

![image-20230708131253057](imgs/image-20230708131253057.png)

### 并发场景下数据同步

![image-20230708131956626](imgs/image-20230708131956626.png)

### 通知协程和多路复用

![image-20230708132517299](imgs/image-20230708132517299.png)

select子句作为一个整体阻塞，其中任意channel准备就绪则继续执行

![image-20230708132535453](imgs/image-20230708132535453.png)

![image-20230708132851000](imgs/image-20230708132851000.png)

## golang文件读写操作
```bash
### 上传下载文件
### 大文件分片传输
### 文件移动
### 文件内容按行获取
```
![image-20230708133452322](imgs/image-20230708133452322-1688794494707-1.png)


### 文件复制

![image-20230708133822811](imgs/image-20230708133822811.png)



### 一次性读取文件内容并写入新文件

![image-20230708134019889](imgs/image-20230708134019889.png)



### 分片读取文件内容，分布写入新文件

边读边写文件

![image-20230708134413679](imgs/image-20230708134413679.png)

![image-20230708134350343](imgs/image-20230708134350343.png)



### 文件按行读取

#### 一次读取，按行拆分并打印

![image-20230708134753847](imgs/image-20230708134753847.png)

#### bufio读取

![image-20230708135112831](imgs/image-20230708135112831.png)

#### scanner读取

![image-20230708135251965](imgs/image-20230708135251965.png)

##  sync/atomic 底层原子级内存操作

![image-20230708140032185](imgs/image-20230708140032185.png)

### atomic

![image-20230708140231777](imgs/image-20230708140231777.png)

![image-20230708140801669](imgs/image-20230708140801669.png)

使用原始的mutex锁

![image-20230708141145685](imgs/image-20230708141145685.png)

atomic方式不需要锁

![image-20230708141318387](imgs/image-20230708141318387.png)

### 奥德赛

原始写法概率性触发并发写map错误

![image-20230708141727665](imgs/image-20230708141727665.png)

![image-20230708142521475](imgs/image-20230708142521475.png)

![image-20230708142545772](imgs/image-20230708142545772.png)

## context

![image-20230708142714007](imgs/image-20230708142714007.png)

![image-20230708143149963](imgs/image-20230708143149963.png)

![image-20230708143335913](imgs/image-20230708143335913.png)

控制协程的退出

![image-20230708152347810](imgs/image-20230708152347810.png)

新的方法：

![image-20230708153157895](imgs/image-20230708153157895.png)

![image-20230708153012174](imgs/image-20230708153012174.png)

![image-20230708153317969](imgs/image-20230708153317969.png)

![image-20230708153443155](imgs/image-20230708153443155.png)

## go 并发

![image-20230708153903610](imgs/image-20230708153903610.png)

### 单协程



![image-20230708154519968](imgs/image-20230708154519968.png)

### 多协程

并发读取无问题，并发写会报错

![image-20230708154734289](imgs/image-20230708154734289.png)

![image-20230708154612257](imgs/image-20230708154612257.png)

### 互斥锁：协程安全



![image-20230708155157409](imgs/image-20230708155157409.png)![image-20230708155209950](imgs/image-20230708155209950.png)

读写锁应用： 读取时读锁，写时互斥锁

![image-20230708163413219](imgs/image-20230708163413219.png)![image-20230708163608482](imgs/image-20230708163608482.png)

### sync.map：并发场景，读多写少，性能较高

<img src="imgs/image-20230708163827375.png" alt="image-20230708163827375" style="zoom:50%;" />

![image-20230708163918944](imgs/image-20230708163918944.png)

![](imgs/image-20230708164442906.png)![](imgs/image-20230708164423442.png)

![image-20230708165153577](imgs/image-20230708165153577.png)

## Pool对象重复利用+Once数据懒加载

![image-20230708165339713](imgs/image-20230708165339713.png)
## sync.Pool

![image-20230708170012779](imgs/image-20230708170012779.png)

连接对象初始化方法：

![image-20230708170117044](imgs/image-20230708170117044.png)

![image-20230708170334891](imgs/image-20230708170334891.png)

![image-20230708170409300](imgs/image-20230708170409300.png)

### case

![image-20230708170551869](imgs/image-20230708170551869.png)

初始化10个连接：

![image-20230708170749048](imgs/image-20230708170749048.png)

## sync.Once

![image-20230708171217154](imgs/image-20230708171217154.png)![image-20230708171335020](imgs/image-20230708171335020.png)

## WaitGroup和Cond 等待一组协程

![image-20230708171549472](imgs/image-20230708171549472.png)

### waitGroup

![image-20230708172630473](imgs/image-20230708172630473.png)

case2

![image-20230708173515750](imgs/image-20230708173515750.png)

![image-20230708173440225](imgs/image-20230708173440225.png)

![image-20230708173535015](imgs/image-20230708173535015.png)

### cond

c.Broadcast():唤醒所有

c.Signal()  只唤醒一个，多次执行唤醒多个

![image-20230708174653921](imgs/image-20230708174653921.png)

![image-20230708174326721](imgs/image-20230708174326721.png)

![image-20230708174528996](imgs/image-20230708174528996.png)

#### cond case2

![image-20230708180155959](imgs/image-20230708180155959.png)

![image-20230708180311456](imgs/image-20230708180311456.png)

![image-20230708180435873](imgs/image-20230708180435873.png)
